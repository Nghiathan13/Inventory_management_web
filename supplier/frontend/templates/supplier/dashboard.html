{% extends 'partials/base.html' %}
<!--  -->
{% load static %}
<!--  -->
{% block title %} Supplier Dashboard {% endblock %}
<!--  -->
{% block content %}
<meta name="csrf-token" content="{{ csrf_token }}" />

<div class="container mt-4">
  <!-- PHẦN 1: CÁC ĐƠN HÀNG ĐANG CHỜ XÁC NHẬN -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <h4><i class="fas fa-box-open me-2"></i>Pending Orders</h4>
    </div>
    <div class="card-body">
      {% if messages %}{% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}{% endif %}

      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Ngày Tạo</th>
              <th class="text-center">Items Count</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in pending_orders %}
            <tr>
              <td>#{{ order.id }}</td>
              <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
              <td class="text-center">{{ order.details.count }}</td>
              <td class="text-center">
                <a href="{% url 'supplier:process_order' order.pk %}" class="btn btn-success btn-sm">
                  <i class="fas fa-arrow-right me-1"></i> Process Order
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted p-4">
                <em>No pending orders found.</em>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PHẦN 2: LỊCH SỬ CÁC ĐƠN HÀNG ĐÃ XÁC NHẬN -->
  <div class="card shadow-sm">
    <div class="card-header">
      <h4><i class="fas fa-history me-2"></i>Purchase Order History</h4>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Confirmed At</th>
              <th class="text-center">Status</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in history_orders %}
            <tr>
              <td>#{{ order.id }}</td>
              <td>{{ order.confirmed_at|date:"d/m/Y H:i"|default:"-" }}</td>
              <td class="text-center">
                <span
                  class="badge {% if order.status == 'Confirmed' %}bg-info{% elif order.status == 'Received' %}bg-success{% else %}bg-secondary{% endif %}"
                >
                  {{ order.get_status_display }}
                </span>
              </td>
              <td class="text-center">
                <a href="{% url 'supplier:download_delivery_note' order.pk %}" class="btn btn-secondary btn-sm">
                  <i class="fas fa-download me-1"></i> Download Label
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted p-4">
                <em>No order history available.</em>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
<!--  -->
{% block javascript %}
<script src="{% static 'supplier/js/dashboard.js' %}"></script>
{% endblock %}
