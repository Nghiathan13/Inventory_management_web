{% extends 'partials/base.html' %}
<!--  -->
{% load static %}
<!--  -->
{% load humanize %}
<!--  -->
{% block extracss %}
<link rel="stylesheet" href="{% static 'css/dashboard/product.css' %}" />
{% endblock %}
<!--  -->
{% block title %} Product Detail: {{ product.name }} {% endblock %}
<!--  -->
{% block content %}
<div class="container mt-4">
  <!-- Áp dụng lớp "form-card" để có giao diện đồng bộ -->
  <div class="card shadow-sm form-card">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <h4><i class="fas fa-pills me-2"></i>Product Details</h4>
        <div>
          <a
            href="{% url 'dashboard-product' %}"
            class="btn btn-secondary btn-sm"
          >
            <i class="fas fa-arrow-left me-1"></i> Back
          </a>
          <a
            href="{% url 'dashboard-product-update' product.id %}"
            class="btn btn-primary btn-sm"
          >
            <i class="fas fa-edit me-1"></i> Edit
          </a>
        </div>
      </div>
    </div>
    <div class="card-body p-4">
      <div class="row">
        <!-- CỘT BÊN TRÁI: ẢNH VÀ THÔNG TIN PHỤ -->
        <div class="col-md-4 text-center">
          <img
            src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'images/default_product.png' %}{% endif %}"
            class="img-thumbnail mb-3 product-detail-image"
            alt="Product Image"
          />
          <p class="mb-1 text-muted">Stock Quantity</p>
          <h1 class="display-4 fw-bold text-info">
            {{ product.quantity|default:0 }}
          </h1>
        </div>

        <!-- CỘT BÊN PHẢI: THÔNG TIN CHÍNH -->
        <div class="col-md-8">
          <h3 class="fw-bold mb-1">{{ product.name }}</h3>
          <p class="text-muted">
            Product Code: <strong>{{ product.code|default:"--" }}</strong>
          </p>
          <hr />
          <dl class="row">
            <dt class="col-sm-4">Product Category:</dt>
            <dd class="col-sm-8">{{ product.category.name|default:"--" }}</dd>

            <dt class="col-sm-4">UoM Category:</dt>
            <dd class="col-sm-8">
              {{ product.uom_category.name|default:"--" }}
            </dd>

            <dt class="col-sm-4">Base UoM:</dt>
            <dd class="col-sm-8">{{ product.base_uom.name|default:"--" }}</dd>

            <dt class="col-sm-4">Supplier:</dt>
            <dd class="col-sm-8">{{ product.supplier|default:"--" }}</dd>
          </dl>
          <hr />
          <h5>Description</h5>
          <p class="text-muted">
            {% if product.description %}
            <!--  -->
            {{ product.description|linebreaksbr }}
            <!--  -->
            {% else %} No description provided. {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Card Lịch Sử Xuất Kho -->
  <div class="card shadow-sm mt-4 form-card">
    <div class="card-header">
      <h5><i class="fas fa-history me-2"></i>Recent Dispense History</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th>Date</th>
              <th>Quantity</th>
              <th>Created By</th>
              <th>Patient</th>
            </tr>
          </thead>
          <tbody>
            {% for order in order_history %}
            <tr>
              <td>{{ order.date|date:"d/m/Y H:i" }}</td>
              <td>{{ order.order_quantity }}</td>
              <td>{{ order.staff.username }}</td>
              <td>
                {{ order.prescription.patient.full_name|default:"Retail Sale" }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center p-3">
                This product has no dispense history.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
